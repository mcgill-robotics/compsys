#!/bin/bash
#
# Update apt, pip, and pip3 dependencies. Update vim plugins.

set -e

section=$(tput bold; tput setaf 2)
reset=$(tput sgr0)

echo "${section}Updating apt dependencies...${reset}"
sudo apt-get -qq update
# Filter out all comments in the apt requirements file using sed before
# piping the contents of the requirements list into xargs.
sed 's/#.*//' "${ROBOTIC_PATH}/compsys/packages/apt" | xargs sudo apt-get install -y

echo "${section}Updating pip3 dependencies...${reset}"
sudo -H pip3 install --upgrade --requirement "${ROBOTIC_PATH}/compsys/packages/pip3"

echo "${section}Updating pip2 dependencies...${reset}"
# The pip package listed in the pip requirements file needs to be installed
# after the pip listed in the pip3 requirements file in order for pip2 to
# be set as the default `pip`.
sudo -H pip2 install --upgrade --requirement "${ROBOTIC_PATH}/compsys/packages/pip"

if [[ $(sudo -H pip --version) != $(sudo -H pip2 --version) ]]; then
  echo "Found mismatch in default pip. Correcting..."
  # This will set the default pip to pip2 as expected
  PIP_PATH=$(sudo which pip)
  PIP2_PATH=$(sudo which pip2)
  sudo rm -f ${PIP_PATH}
  sudo ln -s ${PIP2_PATH} ${PIP_PATH}
fi

if [[ -d ${HOME}/.vim/bundle/Vundle.vim ]]; then
  echo "Updating vim plugins..."
  vim +PluginInstall +qall
fi

echo "Done."
